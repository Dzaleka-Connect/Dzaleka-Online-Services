---
import MainLayout from '../../layouts/MainLayout.astro';
import JobGuide from '../../components/jobs/JobGuide.astro';

---

<MainLayout title="Post a Job">
  <div class="min-h-screen bg-gradient-to-b from-gray-50 via-white to-gray-50">
    <!-- Header -->
    <div class="bg-gradient-to-r from-primary-600 to-primary-800 py-8">
      <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-3xl font-bold text-white">Post a Job</h1>
      </div>
    </div>

    <div class="max-w-3xl mx-auto px-4 py-12">
      <div class="bg-white rounded-xl shadow-sm border border-gray-200/50 overflow-hidden">
        <div class="p-8">
          <form id="jobForm" class="space-y-8">
            <!-- Organization Information -->
            <section>
              <h2 class="text-xl font-semibold text-gray-900 mb-4">Organization Information</h2>
              <div class="space-y-4">
                <div>
                  <label for="organization" class="block text-sm font-medium text-gray-700">Organization Name*</label>
                  <input type="text" id="organization" name="organization" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                </div>

                <div>
                  <label for="website" class="block text-sm font-medium text-gray-700">Website</label>
                  <input type="url" id="website" name="website"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">Contact Email*</label>
                    <input type="email" id="email" name="email" required
                      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                  </div>
                  <div>
                    <label for="phone" class="block text-sm font-medium text-gray-700">Contact Phone</label>
                    <input type="tel" id="phone" name="phone"
                      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                  </div>
                </div>
              </div>
            </section>

            <!-- Job Details -->
            <section>
              <h2 class="text-xl font-semibold text-gray-900 mb-4">Job Details</h2>
              <div class="space-y-4">
                <div>
                  <label for="title" class="block text-sm font-medium text-gray-700">Job Title*</label>
                  <input type="text" id="title" name="title" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label for="type" class="block text-sm font-medium text-gray-700">Job Type*</label>
                    <select id="type" name="type" required
                      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                      <option value="">Select Type</option>
                      <option value="full-time">Full Time</option>
                      <option value="part-time">Part Time</option>
                      <option value="contract">Contract</option>
                      <option value="volunteer">Volunteer</option>
                      <option value="internship">Internship</option>
                    </select>
                  </div>

                  <div>
                    <label for="category" class="block text-sm font-medium text-gray-700">Category*</label>
                    <select id="category" name="category" required
                      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                      <option value="">Select Category</option>
                      <option value="education">Education</option>
                      <option value="healthcare">Healthcare</option>
                      <option value="technology">Technology</option>
                      <option value="community">Community</option>
                      <option value="business">Business</option>
                      <option value="arts">Arts & Culture</option>
                      <option value="services">Services</option>
                      <option value="other">Other</option>
                    </select>
                  </div>
                </div>

                <div>
                  <label for="location" class="block text-sm font-medium text-gray-700">Location*</label>
                  <input type="text" id="location" name="location" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                </div>

                <div>
                  <label for="salary" class="block text-sm font-medium text-gray-700">Salary/Compensation</label>
                  <input type="text" id="salary" name="salary"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                </div>

                <div>
                  <label for="deadline" class="block text-sm font-medium text-gray-700">Application Deadline*</label>
                  <input type="date" id="deadline" name="deadline" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                </div>

                <div>
                  <label for="skills" class="block text-sm font-medium text-gray-700">Required Skills*</label>
                  <input type="text" id="skills" name="skills" required
                    placeholder="Enter skills separated by commas"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                </div>

                <div>
                  <label for="description" class="block text-sm font-medium text-gray-700">Job Description*</label>
                  <textarea id="description" name="description" rows="8" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500"></textarea>
                </div>
              </div>
            </section>

            <div class="flex justify-end space-x-4">
              <button type="button" onclick="window.location.href='/jobs'"
                class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                Cancel
              </button>
              <button type="submit"
                class="px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md shadow-sm hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                Submit Job
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Job Posting Guide -->
      <div class="mt-8">
        <JobGuide />
      </div>
    </div>
  </div>
</MainLayout>

<script>
  const form = document.getElementById('jobForm') as HTMLFormElement;
  
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;
    submitButton.disabled = true;
    submitButton.innerHTML = 'Submitting...';
    
    const formData = new FormData(form);
    const skills = formData.get('skills')?.toString().split(',').map(s => s.trim());
    
    const jobData = {
      ...Object.fromEntries(formData),
      skills,
      posted: new Date().toISOString(),
      status: 'draft'
    };

    try {
      const response = await fetch('https://formspree.io/f/xqaaajae', {
        method: 'POST',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(jobData)
      });

      if (response.ok) {
        // Show success message
        const successHtml = `
          <div class="bg-green-50 p-4 rounded-md">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
              </div>
              <div class="ml-3">
                <h3 class="text-sm font-medium text-green-800">Job Posted Successfully</h3>
                <div class="mt-2 text-sm text-green-700">
                  <p>Your job has been submitted successfully. We'll review it and publish it soon.</p>
                </div>
                <div class="mt-4">
                  <button type="button" onclick="window.location.href='/jobs'" class="bg-green-50 px-2 py-1.5 rounded-md text-sm font-medium text-green-800 hover:bg-green-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-green-50 focus:ring-green-600">
                    View Job Board
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;
        form.innerHTML = successHtml;
      } else {
        throw new Error('Failed to submit job');
      }
    } catch (error) {
      console.error('Error:', error);
      alert('Failed to submit job. Please try again.');
      submitButton.disabled = false;
      submitButton.innerHTML = 'Submit Job';
    }
  });
</script>
