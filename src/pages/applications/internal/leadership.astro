---
import MainLayout from '../../../layouts/MainLayout.astro';
import FormStatus from '../../../components/applications/FormStatus.astro';

const formId = 'leadership-support-form';
---

<MainLayout title="Leadership Support Application">
  <div class="py-16 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-2xl mx-auto">
        <div class="mb-6">
          <a 
            href="/applications" 
            class="inline-flex items-center text-gray-600 hover:text-gray-900 transition-colors"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
            </svg>
            Back to Applications
          </a>
        </div>

        <div class="bg-white rounded-xl shadow-sm p-8">
          <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-4">Leadership Support Application</h1>
            <p class="text-gray-600">
              Apply for leadership training, community organizing support, and capacity building programs.
            </p>
          </header>

          <FormStatus formId={formId} />

          <form
            id={formId}
            action="https://formspree.io/f/xqaaajae"
            method="POST"
            class="space-y-6"
            enctype="multipart/form-data"
            data-netlify-recaptcha="true"
          >
            {/* Hidden Honeypot Field */}
            <input type="text" name="_gotcha" style="display:none" />

            {/* Form Subject */}
            <input 
              type="hidden" 
              name="_subject" 
              value="New Leadership Support Application" 
            />

            {/* Personal Information */}
            <div class="space-y-6">
              <h2 class="text-xl font-semibold text-gray-900">Personal Information</h2>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label for="firstName" class="block text-sm font-medium text-gray-700">First Name</label>
                  <input
                    type="text"
                    name="firstName"
                    id="firstName"
                    required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500"
                  />
                </div>
                
                <div>
                  <label for="lastName" class="block text-sm font-medium text-gray-700">Last Name</label>
                  <input
                    type="text"
                    name="lastName"
                    id="lastName"
                    required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500"
                  />
                </div>
              </div>

              <div>
                <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                <input
                  type="email"
                  name="email"
                  id="email"
                  required
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500"
                />
              </div>

              <div>
                <label for="phone" class="block text-sm font-medium text-gray-700">Phone Number</label>
                <input
                  type="tel"
                  name="phone"
                  id="phone"
                  required
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500"
                />
              </div>

              <div>
                <label for="organization" class="block text-sm font-medium text-gray-700">Organization/Community Group (if any)</label>
                <input
                  type="text"
                  name="organization"
                  id="organization"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500"
                />
              </div>
            </div>

            {/* Leadership Experience */}
            <div class="space-y-6 pt-6 border-t">
              <h2 class="text-xl font-semibold text-gray-900">Leadership Experience</h2>
              
              <div>
                <label for="currentRole" class="block text-sm font-medium text-gray-700">Current Leadership Role (if any)</label>
                <input
                  type="text"
                  name="currentRole"
                  id="currentRole"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500"
                  placeholder="e.g., Community Leader, Youth Coordinator"
                />
              </div>

              <div>
                <label for="experience" class="block text-sm font-medium text-gray-700">Leadership Experience</label>
                <textarea
                  name="experience"
                  id="experience"
                  rows="4"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500"
                  placeholder="Please describe your leadership experience and activities in the community..."
                ></textarea>
              </div>

              <div>
                <label for="supportType" class="block text-sm font-medium text-gray-700">Type of Support Needed</label>
                <select
                  name="supportType"
                  id="supportType"
                  required
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500"
                >
                  <option value="">Select type of support</option>
                  <option value="training">Leadership Training</option>
                  <option value="organizing">Community Organizing</option>
                  <option value="capacityBuilding">Capacity Building</option>
                  <option value="networking">Network Development</option>
                  <option value="other">Other (please specify)</option>
                </select>
              </div>
            </div>

            {/* Project/Initiative Information */}
            <div class="space-y-6 pt-6 border-t">
              <h2 class="text-xl font-semibold text-gray-900">Project/Initiative Information</h2>
              
              <div>
                <label for="projectTitle" class="block text-sm font-medium text-gray-700">Project/Initiative Title (if applicable)</label>
                <input
                  type="text"
                  name="projectTitle"
                  id="projectTitle"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500"
                />
              </div>

              <div>
                <label for="projectDescription" class="block text-sm font-medium text-gray-700">Project/Initiative Description</label>
                <textarea
                  name="projectDescription"
                  id="projectDescription"
                  rows="4"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500"
                  placeholder="Describe your current or planned community initiative..."
                ></textarea>
              </div>

              <div>
                <label for="goals" class="block text-sm font-medium text-gray-700">Goals and Objectives</label>
                <textarea
                  name="goals"
                  id="goals"
                  rows="4"
                  required
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500"
                  placeholder="What do you hope to achieve with this support?"
                ></textarea>
              </div>
            </div>

            {/* File Upload Section */}
            <div class="space-y-6 pt-6 border-t">
              <h2 class="text-xl font-semibold text-gray-900">Supporting Documents</h2>
              
              <div class="space-y-4">
                <div>
                  <label for="documentLinks" class="block text-sm font-medium text-gray-700">
                    Document Links
                  </label>
                  <p class="text-sm text-gray-500 mb-2">
                    Please upload your documents (CV, certificates, recommendations) to Google Drive or another file sharing service and paste the links below. Make sure the links are accessible.
                  </p>
                  <textarea
                    name="documentLinks"
                    id="documentLinks"
                    rows="3"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500"
                    placeholder="Paste your document links here, one per line..."
                  ></textarea>
                </div>
              </div>
            </div>

            {/* Consent */}
            <div class="space-y-6 pt-6 border-t">
              <h2 class="text-xl font-semibold text-gray-900">Consent</h2>
              
              <div class="space-y-4">
                <div class="flex items-start">
                  <div class="flex items-center h-5">
                    <input
                      type="checkbox"
                      name="consent"
                      id="consent"
                      required
                      class="h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"
                    />
                  </div>
                  <div class="ml-3 text-sm">
                    <label for="consent" class="font-medium text-gray-700">Information Consent</label>
                    <p class="text-gray-500">I agree to share my information for the purpose of receiving leadership support and being contacted about relevant opportunities.</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="pt-6">
              {/* reCAPTCHA */}
              <div class="mb-6" data-netlify-recaptcha="true"></div>
              
              <button
                type="submit"
                class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
              >
                Submit Application
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</MainLayout>

<script>
  // Client-side form validation
  window.addEventListener('load', function() {
    const form = document.getElementById(formId);
    const formStatus = document.getElementById('form-status');
    
    if (form) {
      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;

        requiredFields.forEach(field => {
          if (!(field as HTMLInputElement).value.trim()) {
            isValid = false;
            field.classList.add('border-red-500');
          } else {
            field.classList.remove('border-red-500');
          }
        });

        if (!isValid) {
          alert('Please fill in all required fields.');
          return;
        }

        try {
          const formData = new FormData(form as HTMLFormElement);
          const response = await fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
              'Accept': 'application/json'
            }
          });

          if (response.ok) {
            // Redirect to thank you page
            window.location.href = '/thank-you?type=leadership';
          } else {
            throw new Error('Form submission failed');
          }
        } catch (error) {
          console.error('Error:', error);
          if (formStatus) {
            formStatus.textContent = 'There was an error submitting your form. Please try again.';
            formStatus.classList.remove('hidden');
          }
        }
      });
    }
  });
</script>
